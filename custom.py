from set_context import set_context

# 用户名
user_name = 'User'
gpt_name = 'D.A.'
# 头像(svg格式) 来自 https://www.dicebear.com/playground?style=identicon
user_svg = """
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 5 5" fill="none" shape-rendering="crispEdges" width="512" height="512"><desc>"Identicon" by "Florian Körner", licensed under "CC0 1.0". / Remix of the original. - Created with dicebear.com</desc><metadata xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:RDF><cc:Work><dc:title>Identicon</dc:title><dc:creator><cc:Agent rdf:about="https://dicebear.com"><dc:title>Florian Körner</dc:title></cc:Agent></dc:creator><dc:source>https://dicebear.com</dc:source><cc:license rdf:resource="https://creativecommons.org/publicdomain/zero/1.0/" /></cc:Work></rdf:RDF></metadata><mask id="viewboxMask"><rect width="5" height="5" rx="0" ry="0" x="0" y="0" fill="#fff" /></mask><g mask="url(#viewboxMask)"><path d="M0 0h1v1H0V0ZM4 0h1v1H4V0ZM3 0H2v1h1V0Z" fill="#00acc1"/><path fill="#00acc1" d="M2 1h1v1H2z"/><path fill="#00acc1" d="M1 2h3v1H1z"/><path fill="#00acc1" d="M2 3h1v1H2z"/><path d="M2 4H1v1h1V4ZM4 4H3v1h1V4Z" fill="#00acc1"/></g></svg>
"""
gpt_svg = """
<svg xmlns="http://www.w3.org/2000/svg" width="560" height="452" shape-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" xmlns:v="https://vecta.io/nano"><path fill="#fdfdfd" d="M-.5-.5h560v452H-.5V-.5z"/><path fill="#0e3872" d="M269.5 46.5h8v12h-8v-12z"/><path fill="#6889b1" d="M269.5 46.5v12h8c-2.787.977-5.787 1.31-9 1-.318-4.532.015-8.866 1-13z"/><path fill="#1d3c6b" d="M285.5 64.5h-14a18.45 18.45 0 0 1-.5 6c-.692-.525-1.192-1.192-1.5-2 .746-1.236 1.079-2.57 1-4a32.44 32.44 0 0 0-8 .5c-3.146 3.318-6.146 6.818-9 10.5a4.85 4.85 0 0 0-1 4c-2.934.789-4.768 2.789-5.5 6a924.23 924.23 0 0 0-.5 43h4c-.328-11.179.005-22.179 1-33v35h-6v-43c1.877-16.099 10.877-24.766 27-26 4.778-.368 9.111.632 13 3z"/><path fill="#0b3878" d="M285.5 64.5c.992-.172 1.658.162 2 1a4.93 4.93 0 0 0-3 .5c1.931 2.304 4.264 4.138 7 5.5a4.85 4.85 0 0 1 1 4h-6a4.85 4.85 0 0 0 1 4c2.253.753 4.087 2.086 5.5 4l3-2c1.436 2.643 1.602 5.31.5 8-6.151-1.885-12.151-1.885-18 0-3.36-.009-6.36-1.009-9-3-1.667 1-3 2.333-4 4a4.85 4.85 0 0 1-4 1h-10v4c-.995 10.821-1.328 21.821-1 33h-4a924.23 924.23 0 0 1 .5-43c.732-3.211 2.566-5.211 5.5-6a4.85 4.85 0 0 1 1-4c2.854-3.682 5.854-7.182 9-10.5a32.44 32.44 0 0 1 8-.5c.079 1.43-.254 2.764-1 4 .308.808.808 1.475 1.5 2a18.45 18.45 0 0 0 .5-6h14z"/><path fill="#193868" d="M287.5 65.5c7.156 3.968 11.656 9.968 13.5 18a1104.14 1104.14 0 0 1 .5 47c-15.176.329-30.176-.004-45-1a310.55 310.55 0 0 0 42-1.5 244.11 244.11 0 0 0 2-32.5h-4c-.247 6.041.086 12.041 1 18-.168 1.671-.835 3.004-2 4 .326-8.849-.007-17.516-1-26-3.125-.979-6.458-1.313-10-1-.326 8.517.007 16.85 1 25 1.548.321 2.215 1.321 2 3h7c-.734 1.208-1.067 2.541-1 4h-7v4a75.82 75.82 0 0 1-15 1v-4c3.747-.788 7.414-1.122 11-1 .125-3.108-1.208-5.108-4-6 .326-8.517-.007-16.85-1-25h-9v24c2.787.977 5.787 1.31 9 1-2.7 1.329-5.034 3.329-7 6a7.25 7.25 0 0 1-2.5-2c-.449-2.632-1.283-5.132-2.5-7.5a85.18 85.18 0 0 0 1-17.5h-4c.322 5.858-.011 11.525-1 17v-21a4.85 4.85 0 0 0 4-1c1-1.667 2.333-3 4-4 2.64 1.991 5.64 2.991 9 3 5.849-1.885 11.849-1.885 18 0 1.102-2.69.936-5.357-.5-8l-3 2c-1.413-1.914-3.247-3.247-5.5-4a4.85 4.85 0 0 1-1-4h6a4.85 4.85 0 0 0-1-4c-2.736-1.362-5.069-3.196-7-5.5a4.93 4.93 0 0 1 3-.5z"/><path fill="#f9fdfd" d="M277.5 91.5v24h-9v-24h9z"/><path fill="#eef3f5" d="M294.5 91.5c.993 8.484 1.326 17.151 1 26 0 .667-.333 1-1 1h-7c.215-1.679-.452-2.679-2-3v-24h9z"/><path fill="#7e93b0" d="M294.5 91.5h-9v24c-.993-8.15-1.326-16.483-1-25 3.542-.313 6.875.021 10 1z"/><path fill="#abbcd9" d="M277.5 91.5c.993 8.15 1.326 16.483 1 25h-1c-3.213.31-6.213-.023-9-1h9v-24z"/><path fill="#566684" d="M245.5 87.5v43h6c-2.107.968-4.441 1.302-7 1-.329-14.843.004-29.51 1-44z"/><path fill="#103670" d="M277.5 116.5h1c2.792.892 4.125 2.892 4 6-3.586-.122-7.253.212-11 1v4a75.82 75.82 0 0 0 15-1v-4h7c-.067-1.459.266-2.792 1-4 .667 0 1-.333 1-1 1.165-.996 1.832-2.329 2-4-.914-5.959-1.247-11.959-1-18h4a244.11 244.11 0 0 1-2 32.5 310.55 310.55 0 0 1-42 1.5c-.464-4.002.202-7.669 2-11 2.045-1.423 3.045-3.423 3-6 .989-5.475 1.322-11.142 1-17h4a85.18 85.18 0 0 1-1 17.5c1.217 2.368 2.051 4.868 2.5 7.5a7.25 7.25 0 0 0 2.5 2c1.966-2.671 4.3-4.671 7-6z"/><path fill="#0e3071" d="M279.5 95.5h4v16h-4v-16z"/><path fill="#596b87" d="M258.5 118.5c-1.798 3.331-2.464 6.998-2 11 14.824.996 29.824 1.329 45 1-15.158.996-30.491 1.33-46 1v-13h3z"/><path fill="#1a355b" d="M303.5 143.5l9-2c.746-1.236 1.079-2.57 1-4l-80 .5c-1.333 1.333-1.333 2.667 0 4 2.208.191 4.208.691 6 1.5h-10v-7h87v7h-13z"/><path fill="#133569" d="M303.5 143.5h-64c-1.792-.809-3.792-1.309-6-1.5-1.333-1.333-1.333-2.667 0-4l80-.5c.079 1.43-.254 2.764-1 4l-9 2z"/><path fill="#51617a" d="M235.5 150.5a1444.4 1444.4 0 0 1 76-1c.327 9.515-.006 18.848-1 28l-1-2c.993-8.15 1.326-16.483 1-25h-75z"/><path fill="#183865" d="M235.5 150.5h75c.326 8.517-.007 16.85-1 25-6.749-4.022-14.082-6.189-22-6.5-16.244-1.494-32.244-.328-48 3.5-.086-.996.248-1.829 1-2.5 16.858-3.021 33.858-4.021 51-3 5.606.761 10.939 2.261 16 4.5.56-2.688.56-6.022 0-10 2.648-3.399 2.648-6.732 0-10a42.77 42.77 0 0 0-1.5 9c-2.547-1.502-3.38-3.502-2.5-6-21.667-1.333-43.333-1.333-65 0-.96 6.273-1.293 12.607-1 19 0 1.333-.667 2-2 2v-25z"/><path fill="#11356e" d="M239.5 172.5c-.342.838-1.008 1.172-2 1-.293-6.393.04-12.727 1-19 21.667-1.333 43.333-1.333 65 0-.88 2.498-.047 4.498 2.5 6a42.77 42.77 0 0 1 1.5-9c2.648 3.268 2.648 6.601 0 10 .56 3.978.56 7.312 0 10-5.061-2.239-10.394-3.739-16-4.5-17.142-1.021-34.142-.021-51 3-.752.671-1.086 1.504-1 2.5z"/><path fill="#e9f2f8" d="M309.5 175.5l1 2c.321 1.548 1.321 2.215 3 2 .778 4.445.778 8.778 0 13 1.603 2.844 2.103 5.844 1.5 9-.122-1.937-.955-3.27-2.5-4 3.287-12.612-1.38-20.112-14-22.5a612.39 612.39 0 0 0-35-.5v19h-9v-19c-4.622-.344-8.955.323-13 2-2.815.824-4.982 2.491-6.5 5a858.7 858.7 0 0 0-6.5 58l-2 8c-.561-1.408-.895-2.908-1-4.5 1.567-19.321 3.9-38.821 7-58.5-.928-1.268-1.095-2.601-.5-4l1 1c.655-2.128 1.489-4.128 2.5-6 1.333 0 2-.667 2-2 .992.172 1.658-.162 2-1 15.756-3.828 31.756-4.994 48-3.5 7.918.311 15.251 2.478 22 6.5z"/><path fill="#0c3878" d="M263.5 193.5c.617-.111 1.117-.444 1.5-1 .499-5.323.666-10.656.5-16h22c-.214 1.644.12 3.144 1 4.5 7.298 1.099 14.131 1.932 20.5 2.5l1.5 12c-.899 6.066-2.566 11.733-5 17 .087-3.239-.58-6.239-2-9-15.195-.087-30.028.246-44.5 1-.75-.626-1.584-1.126-2.5-1.5a114.37 114.37 0 0 0 14-4.5c1.231-1.151 1.231-2.317 0-3.5-3.584.569-7.25 1.069-11 1.5-2.06-.072-4.06-.405-6-1a40.26 40.26 0 0 1-4.5 4c-2.636-.045-5.47-.212-8.5-.5-.592-4.281-1.592-7.781-3-10.5-1.113-1.446-1.28-3.113-.5-5 2.511-1.722 4.011-4.055 4.5-7 4.045-1.677 8.378-2.344 13-2v19h9z"/><path fill="#19386b" d="M312.5 197.5v4c-2.473 6.279-5.473 12.279-9 18 .378-2.421 1.045-4.754 2-7 2.434-5.267 4.101-10.934 5-17l-1.5-12c-6.369-.568-13.202-1.401-20.5-2.5-.88-1.356-1.214-2.856-1-4.5h-22c.166 5.344-.001 10.677-.5 16-.383.556-.883.889-1.5 1v-19a612.39 612.39 0 0 1 35 .5c12.62 2.388 17.287 9.888 14 22.5z"/><path fill="#2a4075" d="M241.5 176.5c-.489 2.945-1.989 5.278-4.5 7-.78 1.887-.613 3.554.5 5-2.114 6.13-3.448 12.463-4 19l-4 32h-1a858.7 858.7 0 0 1 6.5-58c1.518-2.509 3.685-4.176 6.5-5z"/><path fill="#0a3983" d="M305.5 212.5c-.955 2.246-1.622 4.579-2 7-.122 2.792-1.456 4.792-4 6-.163-2.357.003-4.69.5-7a4.59 4.59 0 0 1 2.5-2.5c-1.135-.749-2.135-.583-3 .5l-2 5.5c-1.561.188-2.228-.645-2-2.5a32.46 32.46 0 0 1-8-.5l1-3-2-8.5a177.36 177.36 0 0 1-2.5 18 13.24 13.24 0 0 0-5-3 54.63 54.63 0 0 1-2-7c-.172 6.181-.672 12.181-1.5 18a120.13 120.13 0 0 0-1.5-25c-1.388-1.054-2.888-1.22-4.5-.5-2.101 5.812-4.434 5.812-7 0-.948-.483-1.948-.649-3-.5.359 2.266-.308 4.099-2 5.5.981 7.413 1.314 14.913 1 22.5-1.086-.12-1.753-.787-2-2a32.52 32.52 0 0 0 .5-13c-2.038.925-4.371.925-7 0-2.322-1.822-4.489-3.822-6.5-6-1.236-.746-2.57-1.079-4-1a25.88 25.88 0 0 1-1 10c-1.136-4.317-1.136-8.651 0-13-.429-3.376-2.096-4.376-5-3 .552-6.537 1.886-12.87 4-19 1.408 2.719 2.408 6.219 3 10.5 3.03.288 5.864.455 8.5.5a40.26 40.26 0 0 0 4.5-4c1.94.595 3.94.928 6 1 3.75-.431 7.416-.931 11-1.5 1.231 1.183 1.231 2.349 0 3.5a114.37 114.37 0 0 1-14 4.5c.916.374 1.75.874 2.5 1.5 14.472-.754 29.305-1.087 44.5-1 1.42 2.761 2.087 5.761 2 9z"/><path fill="#2e4377" d="M313.5 207.5c.722.418 1.222 1.084 1.5 2a794.14 794.14 0 0 1 2.5 25c-1.525-6.055-2.859-12.388-4-19-3.274 3.663-4.94 7.996-5 13a19.22 19.22 0 0 0-6 1c4.228-7.123 7.895-14.456 11-22z"/><path fill="#2c3c8a" d="M317.5 234.5c.869 2.217 1.202 4.55 1 7v15a51.57 51.57 0 0 1-7-1c-.531-3.279-2.531-4.613-6-4 .219-1.175-.114-2.175-1-3a10.26 10.26 0 0 0-1.5 4c-2.466-1.277-4.966-1.277-7.5 0l6 2c-3.654.831-7.154 1.165-10.5 1-.519-1.016-1.353-1.682-2.5-2l-5 2c2.644-2.469 5.477-4.802 8.5-7 1.341-2.522 2.174-5.189 2.5-8l8-11a19.22 19.22 0 0 1 6-1c.06-5.004 1.726-9.337 5-13 1.141 6.612 2.475 12.945 4 19z"/><path fill="#2c3c8d" d="M258.5 235.5c.47 1.193 1.47 1.86 3 2 4.178-.456 8.178-1.123 12-2 1.333 0 2-.667 2-2 .828-5.819 1.328-11.819 1.5-18a54.63 54.63 0 0 0 2 7 13.24 13.24 0 0 1 5 3 177.36 177.36 0 0 0 2.5-18l2 8.5-1 3a32.46 32.46 0 0 0 8 .5c-.228 1.855.439 2.688 2 2.5a66.68 66.68 0 0 0 2-5.5c.865-1.083 1.865-1.249 3-.5a4.59 4.59 0 0 0-2.5 2.5c-.497 2.31-.663 4.643-.5 7a41.2 41.2 0 0 1-10 14 109.04 109.04 0 0 1-8 3.5 18.08 18.08 0 0 0-2 3.5c-5.21 1.588-10.543 2.255-16 2v-3c-4.313.122-8.48-.544-12.5-2a231.04 231.04 0 0 1-7.5 1c-4.281-2.81-8.948-4.477-14-5l4-32c2.904-1.376 4.571-.376 5 3-1.136 4.349-1.136 8.683 0 13a25.88 25.88 0 0 0 1-10c1.43-.079 2.764.254 4 1 2.011 2.178 4.178 4.178 6.5 6 2.629.925 4.962.925 7 0a32.52 32.52 0 0 1-.5 13c.247 1.213.914 1.88 2 2z"/><path fill="#213c74" d="M275.5 233.5c0 1.333-.667 2-2 2-3.822.877-7.822 1.544-12 2-1.53-.14-2.53-.807-3-2 .314-7.587-.019-15.087-1-22.5 1.692-1.401 2.359-3.234 2-5.5 1.052-.149 2.052.017 3 .5 2.566 5.812 4.899 5.812 7 0 1.612-.72 3.112-.554 4.5.5a120.13 120.13 0 0 1 1.5 25z"/><path fill="#f2fafc" d="M273.5 235.5h-14v-21h14v21z"/><path fill="#45418d" d="M228.5 239.5h1c5.052.523 9.719 2.19 14 5a231.04 231.04 0 0 0 7.5-1c4.02 1.456 8.187 2.122 12.5 2v3c5.457.255 10.79-.412 16-2a18.08 18.08 0 0 1 2-3.5 109.04 109.04 0 0 0 8-3.5c-6.632 9.632-14.632 17.965-24 25-.722-.418-1.222-1.084-1.5-2-1.555 2.015-3.389 2.348-5.5 1-2.142-2.07-3.476-4.57-4-7.5a236.59 236.59 0 0 0-11.5-1.5c-2.47-.16-4.636.507-6.5 2-1.932-.645-3.099-1.979-3.5-4-.915.828-1.581 1.828-2 3l-1-4c-.336 5.032-.836 10.032-1.5 15h-1a221.28 221.28 0 0 0 1-27z"/><path fill="#5f4891" d="M265.5 264.5c-4.696 4.021-9.696 7.688-15 11h-3c4.025-3.781 3.025-4.947-3-3.5-1.839 1.132-3.839 1.965-6 2.5-2.914-1.421-5.914-2.588-9-3.5-.88-1.356-1.214-2.856-1-4.5.664-4.968 1.164-9.968 1.5-15l1 4c.419-1.172 1.085-2.172 2-3 .401 2.021 1.568 3.355 3.5 4 1.864-1.493 4.03-2.16 6.5-2a236.59 236.59 0 0 1 11.5 1.5c.524 2.93 1.858 5.43 4 7.5 2.111 1.348 3.945 1.015 5.5-1 .278.916.778 1.582 1.5 2z"/><path fill="#f0ecf9" d="M312.5 201.5c-.295 2.235.039 4.235 1 6-3.105 7.544-6.772 14.877-11 22l-8 11a241.89 241.89 0 0 1-32 32c-3.852 2.425-7.519 5.091-11 8-4.336 1.832-8.336 4.165-12 7a89.72 89.72 0 0 0-16 8c-1.545.73-2.378 2.063-2.5 4a604.49 604.49 0 0 0-1.5 20h-1a406.53 406.53 0 0 0 0-19c.967-4.236 2.3-8.236 4-12 .343 1.725 1.343 2.225 3 1.5 8.761-4.298 17.094-9.131 25-14.5 5.304-3.312 10.304-6.979 15-11 9.368-7.035 17.368-15.368 24-25a41.2 41.2 0 0 0 10-14c2.544-1.208 3.878-3.208 4-6 3.527-5.721 6.527-11.721 9-18z"/><path fill="#514684" d="M294.5 240.5c-.326 2.811-1.159 5.478-2.5 8-3.023 2.198-5.856 4.531-8.5 7-1.782 4.049-1.115 7.549 2 10.5-1.558.21-2.891.71-4 1.5-5.108-1.783-9.441-.616-13 3.5 2.177 1.186 3.177 3.019 3 5.5-.897-1.098-1.73-1.098-2.5 0a8.43 8.43 0 0 1-.5-4h-6a241.89 241.89 0 0 0 32-32z"/><path fill="#464190" d="M318.5 256.5l1 10c-12.615 1.374-25.281 1.707-38 1 1.109-.79 2.442-1.29 4-1.5-3.115-2.951-3.782-6.451-2-10.5l5-2c1.147.318 1.981.984 2.5 2 3.346.165 6.846-.169 10.5-1l-6-2c2.534-1.277 5.034-1.277 7.5 0a10.26 10.26 0 0 1 1.5-4c.886.825 1.219 1.825 1 3 3.469-.613 5.469.721 6 4a51.57 51.57 0 0 0 7 1z"/><path fill="#554490" d="M281.5 267.5c12.719.707 25.385.374 38-1a46.21 46.21 0 0 1 1 22c-1.431-1.28-2.098-2.947-2-5a12.93 12.93 0 0 1-5-.5l2-1c-1.4-1.438-3.067-2.271-5-2.5-.057-5.182-.724-5.182-2 0a10.26 10.26 0 0 1-1.5-4l-1 7c-.186-2.536-.686-4.869-1.5-7-5.771-.613-11.104.054-16 2h-1c-4.702 2.023-9.702 2.523-15 1.5l7-1c-2.754-.272-5.421-.772-8-1.5.177-2.481-.823-4.314-3-5.5 3.559-4.116 7.892-5.283 13-3.5z"/><path fill="#7c5199" d="M227.5 266.5h1c-.214 1.644.12 3.144 1 4.5 3.086.912 6.086 2.079 9 3.5 2.161-.535 4.161-1.368 6-2.5 6.025-1.447 7.025-.281 3 3.5a103.02 103.02 0 0 1-23 11l3-20z"/><path fill="#6b4993" d="M262.5 272.5h6a8.43 8.43 0 0 0 .5 4c.77-1.098 1.603-1.098 2.5 0 2.579.728 5.246 1.228 8 1.5l-7 1c5.298 1.023 10.298.523 15-1.5v12c-5.018.677-10.018 1.177-15 1.5l-9-7a34.1 34.1 0 0 1-6-3c1.626-2.628 3.626-4.961 6-7-.556-.383-.889-.883-1-1.5z"/><path fill="#7c638f" d="M228.5 239.5a221.28 221.28 0 0 1-1 27l-3 20a103.02 103.02 0 0 0 23-11h3c-7.906 5.369-16.239 10.202-25 14.5-1.657.725-2.657.225-3-1.5a640.71 640.71 0 0 0 4-41l2-8z"/><path fill="#875598" d="M251.5 280.5c-.408 1.143-1.075 2.143-2 3-9.453 4.298-8.786 6.465 2 6.5 2.715.875 4.048 2.708 4 5.5 4.88 1.326 9.88 2.16 15 2.5l2 6c5.751.763 11.085 2.43 16 5l19 2.5c3.907-1.311 7.907-1.978 12-2a12.93 12.93 0 0 0 .5 5l1-3c.099 2.153.933 3.819 2.5 5-.369 2.493.297 3.16 2 2 .949 5.24 1.282 10.573 1 16-1.629 1.56-2.796 1.227-3.5-1-.519-4.711-1.352-9.045-2.5-13-1.124 1.869-1.957 3.869-2.5 6-.667 1.333-1.333 1.333-2 0-.779 1.228-1.779 2.228-3 3-3.128-.704-6.294-1.204-9.5-1.5-4.726-2.554-9.726-4.388-15-5.5-1.418-5.357-4.752-7.69-10-7a14.97 14.97 0 0 1-3.5-3c-.414.457-.914.791-1.5 1-2.566-4.444-6.233-6.444-11-6a14.97 14.97 0 0 1-3.5-3c-.718.951-1.551 1.117-2.5.5l-2.5-5.5a76.26 76.26 0 0 0-7.5 0c-1.649-1.148-3.149-2.481-4.5-4l-1 1c-1.067-.691-2.234-1.191-3.5-1.5 1.238-.69 1.238-1.19 0-1.5 1.575-1.614 2.241-3.614 2-6 3.664-2.835 7.664-5.168 12-7z"/><path fill="#774e95" d="M262.5 272.5c.111.617.444 1.117 1 1.5-2.374 2.039-4.374 4.372-6 7a34.1 34.1 0 0 0 6 3l9 7c4.982-.323 9.982-.823 15-1.5v-12h1c-.325 7.519.008 14.852 1 22 4.667 1.333 9.333 1.333 14 0 .992-7.816 1.326-15.816 1-24 .814 2.131 1.314 4.464 1.5 7l1-7a10.26 10.26 0 0 0 1.5 4c1.276-5.182 1.943-5.182 2 0 1.933.229 3.6 1.062 5 2.5l-2 1a12.93 12.93 0 0 0 5 .5c-.098 2.053.569 3.72 2 5l3 28c-1.567-1.181-2.401-2.847-2.5-5l-1 3a12.93 12.93 0 0 1-.5-5c-4.093.022-8.093.689-12 2l-19-2.5c-4.915-2.57-10.249-4.237-16-5l-2-6c-5.12-.34-10.12-1.174-15-2.5.048-2.792-1.285-4.625-4-5.5-10.786-.035-11.453-2.202-2-6.5.925-.857 1.592-1.857 2-3 3.481-2.909 7.148-5.575 11-8z"/><path fill="#fdfafb" d="M303.5 299.5c-4.667 1.333-9.333 1.333-14 0v-23h14v23z"/><path fill="#a595c2" d="M304.5 275.5c.326 8.184-.008 16.184-1 24v-23h-14v23c-.992-7.148-1.325-14.481-1-22 4.896-1.946 10.229-2.613 16-2z"/><path fill="#955c99" d="M237.5 293.5c1.238.31 1.238.81 0 1.5 1.266.309 2.433.809 3.5 1.5l1-1c1.351 1.519 2.851 2.852 4.5 4h7.5l2.5 5.5c.949.617 1.782.451 2.5-.5a14.97 14.97 0 0 0 3.5 3c4.767-.444 8.434 1.556 11 6 .586-.209 1.086-.543 1.5-1a14.97 14.97 0 0 0 3.5 3c5.248-.69 8.582 1.643 10 7 5.274 1.112 10.274 2.946 15 5.5 3.206.296 6.372.796 9.5 1.5 1.221-.772 2.221-1.772 3-3 .667 1.333 1.333 1.333 2 0 .543-2.131 1.376-4.131 2.5-6 1.148 3.955 1.981 8.289 2.5 13 .704 2.227 1.871 2.56 3.5 1-1.612 2.463-1.112 4.463 1.5 6 .414-.457.914-.791 1.5-1 2.891.506 5.558 1.506 8 3l1 2a14.97 14.97 0 0 0-3 3.5 144.18 144.18 0 0 1-24 0l1-1c-9.176-.17-18.176-.67-27-1.5 6.009.166 12.009-.001 18-.5-.837-1.011-1.17-2.178-1-3.5-4.916-1.24-9.916-2.074-15-2.5-.753-1.487-1.586-1.654-2.5-.5-3.069-2.05-2.569-3.55 1.5-4.5-5.659-3.346-11.492-5.513-17.5-6.5L251.5 314c-3.971-.085-7.638-1.085-11-3-3.688-4.686-7.688-9.019-12-13 1.997-3.495 4.997-4.995 9-4.5z"/><path fill="#b0709b" d="M223.5 295.5c2.141 2.996 4.141 6.163 6 9.5-1.238-.077-2.238.089-3 .5a39.5 39.5 0 0 0 8.5 5c2.549 2.431 4.049 5.431 4.5 9 4.899 1.248 9.565 3.248 14 6 1.353 1.185 2.52 2.519 3.5 4 .308-.808.808-1.475 1.5-2l5 5c-.525.692-1.192 1.192-2 1.5.916.278 1.582.778 2 1.5-2.222.322-4.056-.345-5.5-2-2.664 2.455-5.498 2.622-8.5.5-2.667-3.106-5.5-5.939-8.5-8.5l-1 1c-3.737-1.636-7.237-3.636-10.5-6-2.243-.974-4.576-1.308-7-1h-3a604.49 604.49 0 0 1 1.5-20c.122-1.937.955-3.27 2.5-4z"/><path fill="#69528e" d="M318.5 241.5a1155.13 1155.13 0 0 1 7 62v15c-1.703 1.16-2.369.493-2-2l-3-28a46.21 46.21 0 0 0-1-22l-1-10v-15z"/><path fill="#c38298" d="M218.5 319.5h1 3c.514 2.368 1.68 4.368 3.5 6l1-1c2.875 3.741 6.541 6.407 11 8l1-1a6.8 6.8 0 0 0 1.5 3c2.209.606 4.376 1.273 6.5 2 .33 2.911 1.497 5.411 3.5 7.5a6.8 6.8 0 0 0-3 1.5 166.02 166.02 0 0 1 18 3c1.213.247 1.88.914 2 2h-28c.14-1.624-.527-2.79-2-3.5l2-1c-6.875-.239-9.541-3.739-8-10.5l-8-1c.338-2.657-.329-4.99-2-7-.886.825-1.219 1.825-1 3l-2-3v-8z"/><path fill="#b9779a" d="M222.5 319.5c2.424-.308 4.757.026 7 1 3.263 2.364 6.763 4.364 10.5 6l1-1c3 2.561 5.833 5.394 8.5 8.5 3.002 2.122 5.836 1.955 8.5-.5 1.444 1.655 3.278 2.322 5.5 2 1.545 3.148 2.878 6.482 4 10a25.88 25.88 0 0 0 10 1 8.43 8.43 0 0 1 4 .5 22.98 22.98 0 0 0-5 2c1.237.232 2.237.732 3 1.5h-12c-.12-1.086-.787-1.753-2-2a166.02 166.02 0 0 0-18-3 6.8 6.8 0 0 1 3-1.5c-2.003-2.089-3.17-4.589-3.5-7.5-2.124-.727-4.291-1.394-6.5-2a6.8 6.8 0 0 1-1.5-3l-1 1c-4.459-1.593-8.125-4.259-11-8l-1 1c-1.82-1.632-2.986-3.632-3.5-6z"/><path fill="#d59a8e" d="M218.5 327.5l2 3v5c2.657-.338 4.99.329 7 2-1.237.781-2.237 1.781-3 3 2.006 1.5 3.672 3.333 5 5.5-.145.772-.478 1.439-1 2 1.619.236 2.619 1.069 3 2.5-8.585.317-17.085-.017-25.5-1-1.704-8.608 1.796-12.941 10.5-13 .589-3.14 1.256-6.14 2-9z"/><path fill="#a7669b" d="M239.5 287.5c.241 2.386-.425 4.386-2 6-4.003-.495-7.003 1.005-9 4.5 4.312 3.981 8.312 8.314 12 13 3.362 1.915 7.029 2.915 11 3l17.5 13.5c6.008.987 11.841 3.154 17.5 6.5-4.069.95-4.569 2.45-1.5 4.5.914-1.154 1.747-.987 2.5.5 5.084.426 10.084 1.26 15 2.5-.17 1.322.163 2.489 1 3.5-5.991.499-11.991.666-18 .5-2.885-.306-5.552.027-8 1a25.88 25.88 0 0 1-10-1c-1.122-3.518-2.455-6.852-4-10-.418-.722-1.084-1.222-2-1.5.808-.308 1.475-.808 2-1.5l-5-5c-.692.525-1.192 1.192-1.5 2-.98-1.481-2.147-2.815-3.5-4-4.435-2.752-9.101-4.752-14-6-.451-3.569-1.951-6.569-4.5-9a39.5 39.5 0 0 1-8.5-5c.762-.411 1.762-.577 3-.5-1.859-3.337-3.859-6.504-6-9.5a89.72 89.72 0 0 1 16-8z"/><path fill="#cf8d92" d="M239.5 350.5h-8c-.381-1.431-1.381-2.264-3-2.5.522-.561.855-1.228 1-2-1.328-2.167-2.994-4-5-5.5.763-1.219 1.763-2.219 3-3-2.01-1.671-4.343-2.338-7-2v-5c-.219-1.175.114-2.175 1-3 1.671 2.01 2.338 4.343 2 7l8 1c-1.541 6.761 1.125 10.261 8 10.5l-2 1c1.473.71 2.14 1.876 2 3.5z"/><path fill="#956996" d="M325.5 303.5c2.104 11.104 3.437 22.437 4 34 10.289-1.25 13.956 2.917 11 12.5a1859.77 1859.77 0 0 1-61 .5c-.763-.768-1.763-1.268-3-1.5a22.98 22.98 0 0 1 5-2 8.43 8.43 0 0 0-4-.5c2.448-.973 5.115-1.306 8-1 8.824.83 17.824 1.33 27 1.5l-1 1a144.18 144.18 0 0 0 24 0 14.97 14.97 0 0 1 3-3.5l-1-2c-2.442-1.494-5.109-2.494-8-3-.586.209-1.086.543-1.5 1-2.612-1.537-3.112-3.537-1.5-6 .282-5.427-.051-10.76-1-16v-15z"/><path fill="#d59192" d="M223.5 355.5h25c-2.805.819-5.805 1.319-9 1.5 5.062 1.693 10.062 3.693 15 6 .906 1.699 1.239 3.533 1 5.5h-16c-10.667-.333-10.667-.667 0-1 .268-2.619-.065-5.119-1-7.5-5.085-.606-10.085-1.44-15-2.5v-2z"/><path fill="#ad7496" d="M277.5 355.5h64c.313 3.542-.021 6.875-1 10 .172.992-.162 1.658-1 2l-4 1a1151.63 1151.63 0 0 1-48-.5c-4.863-1.799-9.863-3.133-15-4-.935-2.381-1.268-4.881-1-7.5 2.235.295 4.235-.039 6-1z"/><path fill="#ae6d9a" d="M319.5 356.5c-6.009.768-12.176 1.434-18.5 2l-2.5 1a14.84 14.84 0 0 0 4 3.5c10.771 2.934 21.771 4.1 33 3.5-13.494 1.161-27.16 1.327-41 .5-5.961-1.651-11.628-3.984-17-7l18-3c7.993-.5 15.993-.666 24-.5z"/><path fill="#c8879c" d="M248.5 355.5h29c-1.765.961-3.765 1.295-6 1-.268 2.619.065 5.119 1 7.5 5.137.867 10.137 2.201 15 4a1151.63 1151.63 0 0 0 48 .5c-28.495.998-57.162 1.331-86 1h-10v-1h16c.239-1.967-.094-3.801-1-5.5-4.938-2.307-9.938-4.307-15-6 3.195-.181 6.195-.681 9-1.5z"/><path fill="#a0629a" d="M319.5 356.5c6.009-.166 12.009.001 18 .5.916.374 1.75.874 2.5 1.5.497 2.31.663 4.643.5 7-1.542.801-3.208 1.134-5 1-11.229.6-22.229-.566-33-3.5a14.84 14.84 0 0 1-4-3.5l2.5-1c6.324-.566 12.491-1.232 18.5-2z"/><path fill="#e4a97d" d="M223.5 355.5v2c.474 3.421.474 6.755 0 10-5.292.995-10.625 1.328-16 1-1.858-4.027-2.525-8.36-2-13h18z"/><path fill="#de9d89" d="M223.5 357.5c4.915 1.06 9.915 1.894 15 2.5.935 2.381 1.268 4.881 1 7.5-10.667.333-10.667.667 0 1v1h-32v-1c5.375.328 10.708-.005 16-1 .474-3.245.474-6.579 0-10z"/><path fill="#fcf1fb" d="M339.5 367.5c-.077 1.25-.744 2.083-2 2.5 2.809.134 5.643-.032 8.5-.5 7.307 1.94 14.807 2.44 22.5 1.5-1.196-.654-1.196-1.154 0-1.5 2.755 1.131 5.089 2.798 7 5-2.592 3.481-2.592 6.981 0 10.5-.792 1.96-2.125 3.46-4 4.5-38.749.207-77.416-.46-116-2h48c22.173.331 44.173-.003 66-1 .667 0 1-.333 1-1 2.218-2.844 2.552-6.011 1-9.5-.63-1.31-1.63-2.144-3-2.5-36.83-.998-73.83-1.332-111-1-1.544-.203-2.878-.87-4-2-1.797 1.432-3.13 1.099-4-1 28.838.331 57.505-.002 86-1l4-1z"/><path fill="#faf5e7" d="M207.5 369.5h32 10c.87 2.099 2.203 2.432 4 1 1.122 1.13 2.456 1.797 4 2-.342.838-1.008 1.172-2 1h-32c-15.661-.822-31.327-.989-47-.5-1.763 3.243-2.429 6.743-2 10.5-1.322-.17-2.489.163-3.5 1-.579-3.703-.412-7.369.5-11 1.859.039 3.192-.794 4-2.5l8-1 24-.5z"/><path fill="#b08ba7" d="M257.5 372.5c37.17-.332 74.17.002 111 1-23.869-.109-47.536.891-71 3a322.64 322.64 0 0 0-42-2v-1c.992.172 1.658-.162 2-1z"/><path fill="#966791" d="M368.5 373.5c1.37.356 2.37 1.19 3 2.5 1.552 3.489 1.218 6.656-1 9.5.731-4.103-.269-7.603-3-10.5-10.857-.486-21.523.014-32 1.5h-36-2c23.464-2.109 47.131-3.109 71-3z"/><path fill="#c57a99" d="M255.5 374.5a322.64 322.64 0 0 1 42 2h2c-2.063.872-4.063 2.038-6 3.5-1.141.741-1.141 1.575 0 2.5-2.475.464-4.475 1.464-6 3h-15c-.898-2.127-2.564-3.294-5-3.5 4.729-.273 9.396-.939 14-2l-2-1a124.36 124.36 0 0 0-24-1.5c-1.449-1.664-3.449-2.498-6-2.5 1.973-.495 3.973-.662 6-.5z"/><path fill="#f0b262" d="M223.5 374.5v1c-4.896 1.946-10.229 2.613-16 2v4h16v4c-5.526-.321-10.86.012-16 1h-31v-11a1141.86 1141.86 0 0 0 47-1z"/><path fill="#9d5f9a" d="M370.5 385.5c0 .667-.333 1-1 1-16.659-.656-33.325-.99-50-1-.17-1.322.163-2.489 1-3.5a112.97 112.97 0 0 1 15-.5v-5c10.477-1.486 21.143-1.986 32-1.5 2.731 2.897 3.731 6.397 3 10.5z"/><path fill="#e4a87b" d="M223.5 375.5l16 2c.17 1.322-.163 2.489-1 3.5-8.402.359-8.735 1.192-1 2.5 1.213.247 1.88.914 2 2-10.487.994-21.154 1.328-32 1 5.14-.988 10.474-1.321 16-1v-4h-16v-4c5.771.613 11.104-.054 16-2z"/><path fill="#da978d" d="M223.5 373.5h32v1c-2.027-.162-4.027.005-6 .5 2.551.002 4.551.836 6 2.5.292 2.457.292 5.124 0 8h-16c-.12-1.086-.787-1.753-2-2-7.735-1.308-7.402-2.141 1-2.5.837-1.011 1.17-2.178 1-3.5l-16-2v-1-1z"/><path fill="#cf8794" d="M255.5 377.5a124.36 124.36 0 0 1 24 1.5l2 1c-4.604 1.061-9.271 1.727-14 2 2.436.206 4.102 1.373 5 3.5h-17c.292-2.876.292-5.543 0-8z"/><path fill="#ad6a99" d="M299.5 376.5h36v5a112.97 112.97 0 0 0-15 .5c-.837 1.011-1.17 2.178-1 3.5 16.675.01 33.341.344 50 1-21.827.997-43.827 1.331-66 1-4.896-1.946-10.229-2.613-16-2 1.525-1.536 3.525-2.536 6-3-1.141-.925-1.141-1.759 0-2.5 1.937-1.462 3.937-2.628 6-3.5z"/><path fill="#e5c186" d="M223.5 373.5v1a1141.86 1141.86 0 0 1-47 1v11h31v1c-10.687.332-21.354-.001-32-1-.627-.917-.961-1.917-1-3-.429-3.757.237-7.257 2-10.5 15.673-.489 31.339-.322 47 .5z"/><path fill="#cda394" d="M239.5 385.5h16v2h-48v-1c10.846.328 21.513-.006 32-1z"/><path fill="#b08295" d="M255.5 385.5h17 15c5.771-.613 11.104.054 16 2h-48v-2z"/></svg>
"""
# 内容背景
user_background_color = ''
gpt_background_color = 'rgba(225, 230, 235, 0.5)'
# 模型初始设置
initial_content_all = {
    "history": [],
    "paras": {
        "temperature": 1.0,
        "top_p": 1.0,
        "presence_penalty": 0.0,
        "frequency_penalty": 0.0,
    },
    "contexts": {
        'context_select': '不设置',
        'context_input': '',
        'context_level': 4
    }
}
# 上下文
set_context_all = {"不设置": ""}
set_context_all.update(set_context)

# 自定义css、js
css_code = """
    <style>
    section[data-testid="stSidebar"] > div > div:nth-child(2) {
        padding-top: 0.75rem !important;
    }
    
    section.main > div {
        padding-top: 10px;
    }
    
    section[data-testid="stSidebar"] h1 {
        text-shadow: 2px 2px #ccc;
        font-size: 28px !important;
        font-family: "微软雅黑", "auto";
        margin-bottom: 6px;
        font-weight: 500 !important;
    }
    
    section[data-testid="stSidebar"] .stRadio {
        overflow: overlay;
        height: 28vh;
    }
    
    hr {
        margin-top: 20px;
        margin-bottom: 30px;
    }
    
    .avatar {
        display: flex;
        align-items: center;
        gap: 10px;
        pointer-events: none;
        margin: -8px 10px -16px;
    }
    
    .avatar svg {
        width: 30px;
        height: 30px;
    }
    
    .avatar h2 {
        font-size: 20px;
        margin: 0;
    }
    
    .content-div {
        padding: 5px 20px;
        margin: 5px;
        text-align: left;
        border-radius: 10px;
        border: none;
        line-height: 1.6;
        font-size: 17px;
    }
    
    .content-div.assistant p {
        padding: 4px;
        margin: 2px;
    }
    
    .content-div.user p {
        padding: 4px;
        margin: -5px 2px -3px;
    }
    
    div[data-testid="stForm"] {
        border: none;
        padding: 0;
    }
    
    button[kind="primaryFormSubmit"] {
        border: none;
        padding: 0;
    }
    
    div[data-testid="stForm"] + div[data-testid="stHorizontalBlock"] div[data-baseweb="select"] > div:nth-child(1) {
        background-color: transparent;
        justify-content: center;
        font-weight: 300;
        border-radius: 0.25rem;
        margin: 0;
        line-height: 1.4;
        border: 1px solid rgba(49, 51, 63, 0.2);
    }
    </style>
"""

js_code = """
<script>
function checkElements() {
    const textinput = window.parent.document.querySelector("textarea[aria-label='**输入：**']");   //label需要相对应
    const textarea = window.parent.document.querySelector("div[data-baseweb = 'textarea']");
    const button = window.parent.document.querySelector("button[kind='secondaryFormSubmit']");
    const tabs = window.parent.document.querySelectorAll('button[data-baseweb="tab"] p');
    const tabs_div = window.parent.document.querySelector('div[role="tablist"]');
    const tab_panels = window.parent.document.querySelectorAll('div[data-baseweb="tab-panel"]');

    if (textinput && textarea && button && tabs && tabs_div && tab_panels) {
        // 双击点位输入框，同时抑制双击时选中文本事件
        window.parent.document.addEventListener('dblclick', function (event) {
            let activeTab = tabs_div.querySelector('button[aria-selected="true"]');
            if (activeTab.querySelector('p').textContent === '💬 聊天') {
                textinput.focus();
            } else {
                tabs[0].click();
                const waitMs = 50;

                function waitForFocus() {
                    if (window.parent.document.activeElement === textinput) {
                    } else {
                        setTimeout(function () {
                            textinput.focus();
                            waitForFocus();
                        }, waitMs);
                    }
                }

                waitForFocus();
            }
        });
        window.parent.document.addEventListener('mousedown', (event) => {
            if (event.detail === 2) {
                event.preventDefault();
            }
        });
        textinput.addEventListener('focusin', function (event) {
            event.stopPropagation();
            textarea.style.borderColor = 'rgb(255,75,75)';
        });
        textinput.addEventListener('focusout', function (event) {
            event.stopPropagation();
            textarea.style.borderColor = 'white';
        });

        // Ctrl + Enter快捷方式
        window.parent.document.addEventListener("keydown", event => {
            if (event.ctrlKey && event.key === "Enter") {
                if (textinput.textContent !== '') {
                    button.click();
                }
                textinput.blur();
            }
        });

        // 设置 Tab 键
        textinput.addEventListener('keydown', function (event) {
            if (event.keyCode === 9) {
                // 阻止默认行为
                event.preventDefault();
                if (!window.parent.getSelection().toString()) {
                    // 获取当前光标位置
                    const start = this.selectionStart;
                    const end = this.selectionEnd;
                    // 在光标位置插入制表符
                    this.value = this.value.substring(0, start) + '\t' + this.value.substring(end);
                    // 将光标移动到插入的制表符之后
                    this.selectionStart = this.selectionEnd = start + 1;
                }
            }
        });

        // 处理tabs 在第一次切换时的渲染问题
        tabs.forEach(function (tab, index) {
            const tab_panel_child = tab_panels[index].querySelectorAll("*");

            function set_visibility(state) {
                tab_panels[index].style.visibility = state;
                tab_panel_child.forEach(function (child) {
                    child.style.visibility = state;
                });
            }

            tab.addEventListener("click", function (event) {
                set_visibility('hidden')

                let element = tab_panels[index].querySelector('div[data-testid="stVerticalBlock"]');
                let main_block = window.parent.document.querySelector('section.main div[data-testid="stVerticalBlock"]');
                const waitMs = 50;

                function waitForLayout() {
                    if (element.offsetWidth === main_block.offsetWidth) {
                        set_visibility("visible");
                    } else {
                        setTimeout(waitForLayout, waitMs);
                    }
                }

                waitForLayout();
            });
        });
    } else {
        setTimeout(checkElements, 100);
    }
}

checkElements()
</script>
"""
